"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.readDependenciesFromNxDepGraph = void 0;
const tslib_1 = require("tslib");
const devkit_1 = require("@nx/devkit");
const child_process_1 = require("child_process");
const promises_1 = require("fs/promises");
const path_1 = require("path");
function readDependenciesFromNxDepGraph(workspaceRoot, project) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const depGraphFile = (0, path_1.join)('tmp', 'dep-graph.json');
        (0, child_process_1.execSync)(`npx nx dep-graph --file ${depGraphFile}`, {
            cwd: workspaceRoot,
            stdio: 'inherit',
        });
        const absolutePath = (0, path_1.join)(workspaceRoot, depGraphFile);
        const { graph } = yield (0, devkit_1.readJsonFile)(absolutePath);
        yield (0, promises_1.unlink)(absolutePath);
        const deps = graph.dependencies[project];
        console.log('[E2E]: Found dependencies', deps);
        return new Set(deps.map((x) => x.target));
    });
}
exports.readDependenciesFromNxDepGraph = readDependenciesFromNxDepGraph;
//# sourceMappingURL=nx.js.map